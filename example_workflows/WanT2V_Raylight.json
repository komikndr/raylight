{
  "id": "b590dcc4-90de-4786-b0a4-6b9020fb3eb3",
  "revision": 0,
  "last_node_id": 46,
  "last_link_id": 48,
  "nodes": [
    {
      "id": 20,
      "type": "CLIPTextEncode",
      "pos": [
        940,
        750
      ],
      "size": [
        424.6909484863281,
        88
      ],
      "flags": {},
      "order": 12,
      "mode": 0,
      "inputs": [
        {
          "name": "clip",
          "type": "CLIP",
          "link": 17
        }
      ],
      "outputs": [
        {
          "name": "CONDITIONING",
          "type": "CONDITIONING",
          "slot_index": 0,
          "links": [
            33
          ]
        }
      ],
      "title": "CLIP Text Encode (Positive Prompt)",
      "properties": {
        "Node name for S&R": "CLIPTextEncode",
        "cnr_id": "comfy-core",
        "ver": "0.3.55"
      },
      "widgets_values": [
        "色调艳丽，过曝，静态，细节模糊不清，字幕，风格，作品，画作，画面，静止，整体发灰，最差质量，低质量，JPEG压缩残留，丑陋的，残缺的，多余的手指，画得不好的手部，画得不好的脸部，畸形的，毁容的，形态畸形的肢体，手指融合，静止不动的画面，杂乱的背景，三条腿，背景人很多，倒着走"
      ],
      "color": "#232",
      "bgcolor": "#353"
    },
    {
      "id": 21,
      "type": "VAEDecode",
      "pos": [
        1990,
        340
      ],
      "size": [
        210,
        46
      ],
      "flags": {},
      "order": 19,
      "mode": 0,
      "inputs": [
        {
          "name": "samples",
          "type": "LATENT",
          "link": 48
        },
        {
          "name": "vae",
          "type": "VAE",
          "link": 24
        }
      ],
      "outputs": [
        {
          "name": "IMAGE",
          "type": "IMAGE",
          "slot_index": 0,
          "links": [
            21
          ]
        }
      ],
      "properties": {
        "Node name for S&R": "VAEDecode",
        "cnr_id": "comfy-core",
        "ver": "0.3.55"
      },
      "widgets_values": []
    },
    {
      "id": 22,
      "type": "CreateVideo",
      "pos": [
        2230,
        340
      ],
      "size": [
        210,
        78
      ],
      "flags": {},
      "order": 20,
      "mode": 0,
      "inputs": [
        {
          "name": "images",
          "type": "IMAGE",
          "link": 21
        },
        {
          "name": "audio",
          "shape": 7,
          "type": "AUDIO",
          "link": null
        }
      ],
      "outputs": [
        {
          "name": "VIDEO",
          "type": "VIDEO",
          "links": [
            22
          ]
        }
      ],
      "properties": {
        "Node name for S&R": "CreateVideo",
        "cnr_id": "comfy-core",
        "ver": "0.3.55"
      },
      "widgets_values": [
        16
      ]
    },
    {
      "id": 31,
      "type": "RayLoraLoader",
      "pos": [
        622.13916015625,
        600.903564453125
      ],
      "size": [
        270,
        82
      ],
      "flags": {},
      "order": 10,
      "mode": 0,
      "inputs": [
        {
          "name": "prev_ray_lora",
          "shape": 7,
          "type": "RAY_LORA",
          "link": 35
        }
      ],
      "outputs": [
        {
          "name": "ray_lora",
          "type": "RAY_LORA",
          "links": [
            30
          ]
        }
      ],
      "properties": {
        "Node name for S&R": "RayLoraLoader",
        "cnr_id": "raylight",
        "ver": "0.2.0"
      },
      "widgets_values": [
        "Wan2_1_self_forcing_dmd_1_3B_lora_rank_32_fp16.safetensors",
        1
      ]
    },
    {
      "id": 35,
      "type": "RayLoraLoader",
      "pos": [
        624.6658935546875,
        731.8026733398438
      ],
      "size": [
        270,
        82
      ],
      "flags": {},
      "order": 0,
      "mode": 0,
      "inputs": [
        {
          "name": "prev_ray_lora",
          "shape": 7,
          "type": "RAY_LORA",
          "link": null
        }
      ],
      "outputs": [
        {
          "name": "ray_lora",
          "type": "RAY_LORA",
          "links": [
            35
          ]
        }
      ],
      "properties": {
        "Node name for S&R": "RayLoraLoader",
        "cnr_id": "raylight",
        "ver": "0.2.0"
      },
      "widgets_values": [
        "Studio_Ghibli_LORA_1_3B.safetensors",
        1
      ]
    },
    {
      "id": 8,
      "type": "RayUNETLoader",
      "pos": [
        954.1246948242188,
        339.85400390625
      ],
      "size": [
        270,
        102
      ],
      "flags": {},
      "order": 13,
      "mode": 0,
      "inputs": [
        {
          "name": "ray_actors_init",
          "type": "RAY_ACTORS_INIT",
          "link": 40
        },
        {
          "name": "lora",
          "shape": 7,
          "type": "RAY_LORA",
          "link": 30
        }
      ],
      "outputs": [
        {
          "name": "ray_actors",
          "type": "RAY_ACTORS",
          "links": [
            37
          ]
        }
      ],
      "properties": {
        "Node name for S&R": "RayUNETLoader",
        "cnr_id": "raylight",
        "ver": "0.2.0"
      },
      "widgets_values": [
        "Wan2_1-T2V-1_3B_bf16.safetensors",
        "default"
      ]
    },
    {
      "id": 15,
      "type": "CLIPLoader",
      "pos": [
        940,
        880
      ],
      "size": [
        429.68731689453125,
        106
      ],
      "flags": {},
      "order": 1,
      "mode": 0,
      "inputs": [],
      "outputs": [
        {
          "name": "CLIP",
          "type": "CLIP",
          "slot_index": 0,
          "links": [
            15,
            17
          ]
        }
      ],
      "properties": {
        "Node name for S&R": "CLIPLoader",
        "cnr_id": "comfy-core",
        "ver": "0.3.55",
        "models": [
          {
            "name": "umt5_xxl_fp8_e4m3fn_scaled.safetensors",
            "url": "https://huggingface.co/Comfy-Org/Wan_2.1_ComfyUI_repackaged/resolve/main/split_files/text_encoders/umt5_xxl_fp8_e4m3fn_scaled.safetensors?download=true",
            "directory": "text_encoders"
          }
        ]
      },
      "widgets_values": [
        "umt5_xxl_fp8_e4m3fn_scaled.safetensors",
        "wan",
        "default"
      ]
    },
    {
      "id": 19,
      "type": "EmptyHunyuanLatentVideo",
      "pos": [
        1391.0992431640625,
        855.9075927734375
      ],
      "size": [
        210.09432983398438,
        130
      ],
      "flags": {},
      "order": 2,
      "mode": 0,
      "inputs": [],
      "outputs": [
        {
          "name": "LATENT",
          "type": "LATENT",
          "slot_index": 0,
          "links": [
            46
          ]
        }
      ],
      "properties": {
        "Node name for S&R": "EmptyHunyuanLatentVideo",
        "cnr_id": "comfy-core",
        "ver": "0.3.55"
      },
      "widgets_values": [
        832,
        480,
        33,
        1
      ]
    },
    {
      "id": 23,
      "type": "SaveVideo",
      "pos": [
        2010,
        480
      ],
      "size": [
        432.9290466308594,
        453.8443908691406
      ],
      "flags": {},
      "order": 21,
      "mode": 0,
      "inputs": [
        {
          "name": "video",
          "type": "VIDEO",
          "link": 22
        }
      ],
      "outputs": [],
      "properties": {
        "Node name for S&R": "SaveVideo",
        "cnr_id": "comfy-core",
        "ver": "0.3.55"
      },
      "widgets_values": [
        "raylight/gen_",
        "auto",
        "auto"
      ]
    },
    {
      "id": 43,
      "type": "MarkdownNote",
      "pos": [
        861.647216796875,
        -17.82110023498535
      ],
      "size": [
        470.2823486328125,
        127.1243667602539
      ],
      "flags": {},
      "order": 3,
      "mode": 0,
      "inputs": [],
      "outputs": [],
      "properties": {},
      "widgets_values": [
        "\nRaylight uses **FSDP2** to shard the model across GPUs.\n\nIn rare cases, a memory leak may occur when switching from one LoRA to another while using FSDP. However, in most tests this issue does not appear, even with the same Docker setup....\n\nIf memory leak cases continue to grow, I will force a reinitialization of the Ray worker.\n\nIn the meantime, if you encounter this issue, please restart Comfy.\nOpen Issue on [Raylight Issue](https://github.com/komikndr/raylight/issues)\n"
      ],
      "color": "#432",
      "bgcolor": "#653"
    },
    {
      "id": 26,
      "type": "Note",
      "pos": [
        634.6205444335938,
        -17.458473205566406
      ],
      "size": [
        215.3394317626953,
        117.74829864501953
      ],
      "flags": {},
      "order": 4,
      "mode": 0,
      "inputs": [],
      "outputs": [],
      "title": "Glosarry",
      "properties": {},
      "widgets_values": [
        "rank = id assigned to the GPU\nworld_size = number of GPUs\n\n"
      ],
      "color": "#432",
      "bgcolor": "#653"
    },
    {
      "id": 25,
      "type": "Note",
      "pos": [
        637.6275634765625,
        149.91604614257812
      ],
      "size": [
        214.7521209716797,
        126.13883209228516
      ],
      "flags": {},
      "order": 5,
      "mode": 0,
      "inputs": [],
      "outputs": [],
      "title": "Rule of thumb",
      "properties": {},
      "widgets_values": [
        "Just jack up more ulysses per number of GPUs, and set ring only 1.\n"
      ],
      "color": "#432",
      "bgcolor": "#653"
    },
    {
      "id": 24,
      "type": "Note",
      "pos": [
        866.1021728515625,
        151.35765075683594
      ],
      "size": [
        462.6545715332031,
        127.88713836669922
      ],
      "flags": {},
      "order": 6,
      "mode": 0,
      "inputs": [],
      "outputs": [],
      "title": "Ulyssess vs Ring",
      "properties": {},
      "widgets_values": [
        "Why use Ulysses instead of Ring? Ulysses requires less VRAM, but the attention heads must be divisible among the GPUs. For example, Wan has 40 blocks, so the number of GPUs per Ulysses can be 2, 4, 5, 8, 10, or 20.\n\nRing, on the other hand, doesn’t have that restriction since it’s basically like a game of musical chairs—just without removing the chairs. However, the biggest problem with Ring is communication inefficiency and computation overhead"
      ],
      "color": "#432",
      "bgcolor": "#653"
    },
    {
      "id": 16,
      "type": "VAELoader",
      "pos": [
        1645.53271484375,
        721.1167602539062
      ],
      "size": [
        295.85809326171875,
        61.84592056274414
      ],
      "flags": {},
      "order": 7,
      "mode": 0,
      "inputs": [],
      "outputs": [
        {
          "name": "VAE",
          "type": "VAE",
          "slot_index": 0,
          "links": [
            24
          ]
        }
      ],
      "properties": {
        "Node name for S&R": "VAELoader",
        "cnr_id": "comfy-core",
        "ver": "0.3.55",
        "models": [
          {
            "name": "wan_2.1_vae.safetensors",
            "url": "https://huggingface.co/Comfy-Org/Wan_2.1_ComfyUI_repackaged/resolve/main/split_files/vae/wan_2.1_vae.safetensors?download=true",
            "directory": "vae"
          }
        ]
      },
      "widgets_values": [
        "Wan2_1_VAE_bf16.safetensors"
      ]
    },
    {
      "id": 44,
      "type": "MarkdownNote",
      "pos": [
        240.78379821777344,
        -17.8378849029541
      ],
      "size": [
        363.9535217285156,
        819.131103515625
      ],
      "flags": {},
      "order": 8,
      "mode": 0,
      "inputs": [],
      "outputs": [],
      "title": "Introduction",
      "properties": {},
      "widgets_values": [
        "## Raylight Overview\n\nAs the name implies, **Raylight** uses Ray workers, called *Actors*.  \nEach worker is its own Python process. While this allows splitting across multiple VRAMs,  \nit does increase overall RAM usage.  \n\nThat said, RAM is generally much cheaper than VRAM, so this trade-off is acceptable in most cases.  \n\n---\n\nMore info: [Raylight on GitHub](https://github.com/komikndr/raylight)\n\n\n## Supported Models\n\n| Model             | USP | FSDP |\n|-------------------|-----|------|\n| Wan2.1 1.3B T2V      | ✅  | ✅   |\n| Wan2.1 14B T2V       | ✅  | ✅   |\n| Wan2.1 14B I2V       | ✅  | ✅   |\n| Wan2.1 Vace             | ✅  | ❌   |\n| Wan2.2 5B TI2V       | ✅  | ✅   |\n| Wan2.2 14B I2V       | ✅  | ✅   |\n| Flux Dev          | ✅  | ✅   |\n| Flux Konteks      | ✅  | ✅   |\n| Flux ControlNet   | ❌  | ❌   |\n| Qwen Image        | ✅  | ✅   |\n| Hunyuan Video     | ❌  | ❓   |\n\n**Legend:**\n- ✅ = Supported\n- ❌ = Not currently supported\n- ❓ = Maybe work?\n\n**Notes:**\n- Non standard Wan variant (Phantom, S2V, etc...) is not tested\n\n## Scaled vs Non-Scaled Models\n\n| Model       | USP | FSDP |\n|-------------|-----|------|\n| Non-Scaled  | ✅  | ✅   |\n| Scaled      | ✅  | ⚠️ |\n\n**Notes:**\n- Scaled models use multiple dtypes inside their transformer blocks: typically **FP32** for scale, **FP16** for bias, and **FP8** for weights.\n- Only Ada Lovelace and newer GPUs support **FP8 scaled FSDP2**.\n\n"
      ],
      "color": "#432",
      "bgcolor": "#653"
    },
    {
      "id": 38,
      "type": "RayInitializer",
      "pos": [
        625.0982666015625,
        329.71026611328125
      ],
      "size": [
        270.17230224609375,
        226
      ],
      "flags": {},
      "order": 9,
      "mode": 0,
      "inputs": [],
      "outputs": [
        {
          "name": "ray_actors_init",
          "type": "RAY_ACTORS_INIT",
          "links": [
            40
          ]
        }
      ],
      "properties": {
        "Node name for S&R": "RayInitializer"
      },
      "widgets_values": [
        "local",
        "default",
        2,
        2,
        1,
        false,
        false,
        "TORCH"
      ]
    },
    {
      "id": 17,
      "type": "CLIPTextEncode",
      "pos": [
        940,
        610
      ],
      "size": [
        424.6909484863281,
        88
      ],
      "flags": {},
      "order": 11,
      "mode": 0,
      "inputs": [
        {
          "name": "clip",
          "type": "CLIP",
          "link": 15
        }
      ],
      "outputs": [
        {
          "name": "CONDITIONING",
          "type": "CONDITIONING",
          "slot_index": 0,
          "links": [
            31
          ]
        }
      ],
      "title": "CLIP Text Encode (Positive Prompt)",
      "properties": {
        "Node name for S&R": "CLIPTextEncode",
        "cnr_id": "comfy-core",
        "ver": "0.3.55"
      },
      "widgets_values": [
        "A crow standing on top of 2 graphic cards on top of building in london theme city, raining, dark sky"
      ],
      "color": "#232",
      "bgcolor": "#353"
    },
    {
      "id": 39,
      "type": "RayTorchCompileModel",
      "pos": [
        1263.7816162109375,
        337.50848388671875
      ],
      "size": [
        270,
        58
      ],
      "flags": {},
      "order": 16,
      "mode": 4,
      "inputs": [
        {
          "name": "ray_actors",
          "type": "RAY_ACTORS",
          "link": 37
        }
      ],
      "outputs": [
        {
          "name": "ray_actors",
          "type": "RAY_ACTORS",
          "links": [
            41
          ]
        }
      ],
      "properties": {
        "Node name for S&R": "RayTorchCompileModel"
      },
      "widgets_values": [
        "inductor"
      ]
    },
    {
      "id": 33,
      "type": "easy cleanGpuUsed",
      "pos": [
        1384.3603515625,
        611.811767578125
      ],
      "size": [
        157.38925170898438,
        26
      ],
      "flags": {},
      "order": 14,
      "mode": 0,
      "inputs": [
        {
          "name": "anything",
          "type": "*",
          "link": 31
        }
      ],
      "outputs": [
        {
          "name": "output",
          "type": "*",
          "links": [
            44
          ]
        }
      ],
      "properties": {
        "Node name for S&R": "easy cleanGpuUsed",
        "cnr_id": "comfyui-easy-use",
        "ver": "3f37ba9491fa7f6c8520dda6cf92a8e2dcbee8fa"
      },
      "widgets_values": []
    },
    {
      "id": 45,
      "type": "RayModelSamplingSD3",
      "pos": [
        1267.08154296875,
        458.28961181640625
      ],
      "size": [
        270,
        58
      ],
      "flags": {},
      "order": 17,
      "mode": 0,
      "inputs": [
        {
          "name": "ray_actors",
          "type": "RAY_ACTORS",
          "link": 41
        }
      ],
      "outputs": [
        {
          "name": "ray_actors",
          "type": "RAY_ACTORS",
          "links": [
            43
          ]
        }
      ],
      "properties": {
        "Node name for S&R": "RayModelSamplingSD3"
      },
      "widgets_values": [
        8
      ]
    },
    {
      "id": 34,
      "type": "easy cleanGpuUsed",
      "pos": [
        1397.2000732421875,
        751.2163696289062
      ],
      "size": [
        157.38925170898438,
        26
      ],
      "flags": {},
      "order": 15,
      "mode": 0,
      "inputs": [
        {
          "name": "anything",
          "type": "*",
          "link": 33
        }
      ],
      "outputs": [
        {
          "name": "output",
          "type": "*",
          "links": [
            47
          ]
        }
      ],
      "properties": {
        "Node name for S&R": "easy cleanGpuUsed",
        "cnr_id": "comfyui-easy-use",
        "ver": "3f37ba9491fa7f6c8520dda6cf92a8e2dcbee8fa"
      },
      "widgets_values": []
    },
    {
      "id": 46,
      "type": "XFuserKSamplerAdvanced",
      "pos": [
        1634.181884765625,
        336.6947937011719
      ],
      "size": [
        304.748046875,
        334
      ],
      "flags": {},
      "order": 18,
      "mode": 0,
      "inputs": [
        {
          "name": "ray_actors",
          "type": "RAY_ACTORS",
          "link": 43
        },
        {
          "name": "positive",
          "type": "CONDITIONING",
          "link": 44
        },
        {
          "name": "negative",
          "type": "CONDITIONING",
          "link": 47
        },
        {
          "name": "latent_image",
          "type": "LATENT",
          "link": 46
        }
      ],
      "outputs": [
        {
          "name": "LATENT",
          "type": "LATENT",
          "links": [
            48
          ]
        }
      ],
      "properties": {
        "Node name for S&R": "XFuserKSamplerAdvanced"
      },
      "widgets_values": [
        "enable",
        0,
        "randomize",
        4,
        1,
        "euler",
        "simple",
        0,
        10000,
        "disable"
      ]
    }
  ],
  "links": [
    [
      15,
      15,
      0,
      17,
      0,
      "CLIP"
    ],
    [
      17,
      15,
      0,
      20,
      0,
      "CLIP"
    ],
    [
      21,
      21,
      0,
      22,
      0,
      "IMAGE"
    ],
    [
      22,
      22,
      0,
      23,
      0,
      "VIDEO"
    ],
    [
      24,
      16,
      0,
      21,
      1,
      "VAE"
    ],
    [
      30,
      31,
      0,
      8,
      1,
      "RAY_LORA"
    ],
    [
      31,
      17,
      0,
      33,
      0,
      "*"
    ],
    [
      33,
      20,
      0,
      34,
      0,
      "*"
    ],
    [
      35,
      35,
      0,
      31,
      0,
      "RAY_LORA"
    ],
    [
      37,
      8,
      0,
      39,
      0,
      "RAY_ACTORS"
    ],
    [
      40,
      38,
      0,
      8,
      0,
      "RAY_ACTORS_INIT"
    ],
    [
      41,
      39,
      0,
      45,
      0,
      "RAY_ACTORS"
    ],
    [
      43,
      45,
      0,
      46,
      0,
      "RAY_ACTORS"
    ],
    [
      44,
      33,
      0,
      46,
      1,
      "CONDITIONING"
    ],
    [
      46,
      19,
      0,
      46,
      3,
      "LATENT"
    ],
    [
      47,
      34,
      0,
      46,
      2,
      "CONDITIONING"
    ],
    [
      48,
      46,
      0,
      21,
      0,
      "LATENT"
    ]
  ],
  "groups": [],
  "config": {},
  "extra": {
    "ds": {
      "scale": 1.0834705943388416,
      "offset": [
        -892.1209140026943,
        -99.49371810617129
      ]
    },
    "frontendVersion": "1.26.11"
  },
  "version": 0.4
}